<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Agentic Index Repo Index</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; }
    #filters { margin-bottom: 1rem; display: flex; gap: 1rem; align-items: center; }
  </style>
</head>
<body>
  <h1>Agentic Index Repository Index</h1>
  
  <!-- CI Health Status Bar -->
  <div id="ci-health-bar" style="background: linear-gradient(90deg, #f56565 0%, #ed8936 50%, #48bb78 100%); padding: 12px; border-radius: 8px; margin-bottom: 20px; color: white; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
    <div>
      <span id="ci-status-text">ðŸ”„ Loading CI Health Status...</span>
    </div>
    <a href="ci_dashboard.html" style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 4px; font-size: 14px;">ðŸ“Š View Dashboard</a>
  </div>
  
  <div id="filters">
    <label>Stars: <input type="range" id="starsRange" min="0" max="20000" step="100" value="0"></label>
    <span id="starsValue">0+</span>
    <label>Category:
      <select id="categorySelect"></select>
    </label>
    <label><input type="checkbox" id="recentToggle"> Updated &lt;30d</label>
  </div>
  <table id="repoTable">
    <thead>
      <tr><th>Name</th><th>Stars</th><th>Category</th><th>Updated</th></tr>
    </thead>
    <tbody></tbody>
  </table>
<script>
async function load() {
  const res = await fetch('data/repos.json');
  const data = await res.json();
  const tbody = document.querySelector('#repoTable tbody');
  const catSel = document.getElementById('categorySelect');
  const range = document.getElementById('starsRange');
  const rangeVal = document.getElementById('starsValue');
  const toggle = document.getElementById('recentToggle');

  const categories = Array.from(new Set(data.map(r => r.category)));
  catSel.innerHTML = '<option value="">All</option>' + categories.map(c => `<option>${c}</option>`).join('');

  function render() {
    const minStars = parseInt(range.value);
    rangeVal.textContent = minStars + '+';
    const cat = catSel.value;
    const now = Date.now();
    const rows = data.filter(r => {
      if (r.stars < minStars) return false;
      if (cat && r.category !== cat) return false;
      if (toggle.checked) {
        const diff = (now - new Date(r.updated_at)) / (1000*60*60*24);
        if (diff > 30) return false;
      }
      return true;
    }).map(r => `<tr><td><a href="${r.url}">${r.name}</a></td><td>${r.stars}</td><td>${r.category}</td><td>${r.updated_at}</td></tr>`).join('');
    tbody.innerHTML = rows;
  }

  range.oninput = render;
  catSel.onchange = render;
  toggle.onchange = render;
  render();
  
  // Load CI health status
  loadCIHealth();
}

async function loadCIHealth() {
  try {
    const res = await fetch('ci_report.json');
    const report = await res.json();
    
    const total = report.summary.total_workflows;
    const healthy = report.summary.healthy_workflows;
    const critical = report.summary.total_critical_issues;
    const healthPct = (healthy / total * 100);
    
    const statusText = document.getElementById('ci-status-text');
    const healthBar = document.getElementById('ci-health-bar');
    
    // Update status text
    statusText.innerHTML = `ðŸš€ CI Health: <strong>${healthy}/${total}</strong> workflows healthy (${healthPct.toFixed(1)}%) â€¢ ${critical} critical issues`;
    
    // Update background color based on health
    if (healthPct >= 80) {
      healthBar.style.background = 'linear-gradient(90deg, #48bb78 0%, #38a169 100%)';
    } else if (healthPct >= 60) {
      healthBar.style.background = 'linear-gradient(90deg, #ed8936 0%, #dd6b20 100%)';
    } else {
      healthBar.style.background = 'linear-gradient(90deg, #f56565 0%, #e53e3e 100%)';
    }
    
  } catch (error) {
    console.log('CI health data not available yet');
    const statusText = document.getElementById('ci-status-text');
    statusText.innerHTML = 'ðŸ”§ CI Health Dashboard - <a href="ci_dashboard.html" style="color: white; text-decoration: underline;">View Status</a>';
  }
}

load();
</script>
</body>
</html>
